var baseDomain="www.livewebtraffic.com";function createXHR(){var e=null;try{e=new XMLHttpRequest}catch(a){for(var t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.3.0","Msxml2.XMLHTTP"],n=0,o=t.length;n<o;n++)try{e=new ActiveXObject(t[n])}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}}return e}function createAjaxRequest(e,t,n,o,a){var i=createXHR();i&&"withCredentials"in i?i.open(e,t,!0):window.ActiveXObject?i.open(e,t):i=null,i&&("withCredentials"in i?(i.onprogress=function(){},i.ontimeout=function(){},i.onload=function(e){n(i,e)},i.onerror=function(e){o(i,e)}):i.onreadystatechange=function(e){4===i.readyState&&200===i.status?n(i,e):o(i,e)},i.send(a))}function getOSName(){var e="Unknown";return-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(e="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(e="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(e="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(e="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(e="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(e="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(e="Mac/iOS"),-1!=window.navigator.userAgent.indexOf("X11")&&(e="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(e="Linux"),e}function timeSince(e){var t=new Date,n=new Date(e).toLocaleString(),o=new Date(n),a=Math.abs((t.getTime()-o.getTime())/1e3),i=3600,r=24*i;return isNaN(a)||a<0?"":a<2?"right now":a<60?Math.floor(a/1)+" seconds ago":a<120?"about 1 minute ago":a<i?Math.floor(a/60)+" minutes ago":a<2*i?"about 1 hour ago":a<r?Math.floor(a/i)+" hours ago":a>r&&a<2*r?"yesterday":a<365*r?Math.floor(a/r)+" days ago":"over a year ago"}function ipJsonSuccess(e,t){if(e.responseText&&(result=JSON.parse(e.responseText),200==e.status)){var n=new Date;n=n.toGMTString();var o=(new Date).getTimezoneOffset(),a=Intl.DateTimeFormat().resolvedOptions().timeZone,i=result.ip;createAjaxRequest("GET","//"+baseDomain+"/tipdetails.php?ip="+i+"&domain="+location.host+"&currTime="+n+"&timeZone="+o+"&ipData="+e.responseText+"&timeZoneLoca="+a+"&url="+window.location.href,wFeedSuccess,errorCallBack)}}function errorCallBack(e,t){e.responseText&&console.log(e.responseText)}function wFeedSuccess(e,t){e.responseText&&(result=JSON.parse(e.responseText),200==e.status&&(document.getElementById("rowContainer").innerHTML=addVisitorRows(result),applyTableStyles(),updateTimer(),setInterval(function(){checkNewEntry()},60000)))}function updateTimer(){setInterval(function(){for(var e=document.getElementsByClassName("timeAgoContainer"),t=0;t<e.length;t++){var n=e[t].getAttribute("rel");e[t].innerHTML=timeSince(n)}},1e3)}function createTable(e){var t="";return t+="<div id='feedContainer'>",t+="<div class='topHeader' id='topHeader'><a href='//"+baseDomain+"/traffic_full.php?domain="+e+"' target='_blank'>Real Time View</a></div>",t+="<div id='rowContainer'>",t+="</div>",t+="<div class='bottomFooter' id='bottomFooter'>Powered By <a href='//"+baseDomain+"' target='_blank'>"+baseDomain+"</a></div>",t+="</div>"}function applyTableStyles(){var e=document.getElementById("feedContainer");e.style.width="240px",e.style.margin="0px auto",e.style.border="1px solid #337ab7",document.getElementById("rowContainer").style.color="#ffffff";for(var t=document.querySelectorAll(".visitorRow"),n=0;n<t.length;n++)t[n].style.marginBottom="5px",t[n].style.padding="5px",t[n].style.borderBottom="1px solid #337ab7",t[n].style.fontSize="13px",t[n].style.color="#717171",t[n].style.background="#ffffff",t[n].style.textAlign="left",t[n].style.wordBreak="break-word",t[n].getElementsByTagName("img")[0]&&(t[n].getElementsByTagName("img")[0].style.minWidth="24px",t[n].getElementsByTagName("img")[0].style.marginTop="5px");var o=document.getElementById("topHeader"),a=document.getElementById("bottomFooter");o.style.textAlign="center",o.style.border="1px solid grey",o.style.padding="5px",o.style.background="#337ab7",o.style.color="#ffffff",o.getElementsByTagName("a")[0].style.color="#fff",a.style.textAlign="center",a.style.border="1px solid grey",a.style.padding="5px",a.style.background="#337ab7",a.style.color="#ffffff",a.getElementsByTagName("a")[0].style.color="#fff"}function checkNewEntry(){if(document.getElementsByClassName("visitorRow").length){var e=document.getElementsByClassName("visitorRow")[0].getAttribute("data-attr"),t=document.getElementsByClassName("visitorRow")[0].getAttribute("data-attr-domain");createAjaxRequest("GET","//"+baseDomain+"/tfeed_curr.php?last_id="+e+"&domain_id="+t+"&domain_name="+location.hostname,newFeedSuccess,errorCallBack)}}function newFeedSuccess(e,t){if(e.responseText&&(result=JSON.parse(e.responseText),200==e.status)){var n=document.getElementById("rowContainer").firstChild,o=document.createElement("div");o.className="newFeedRow",o.style.height="0px",o.style.transition="opacity 1s ease-out",o.style.opacity="0",o.style.background="khaki",o.style.fontWeight="600",o.innerHTML=addVisitorRows(result),result&&result.length&&n.parentNode.insertBefore(o,n),setTimeout(function(){o.style.height="auto",o.style.opacity="1",applyNewRow(),applyTableStyles()},500)}}function addVisitorRows(e){var t="";if(e&&e.length)for(var n=0;n<e.length;n++){var o=[];e[n].city&&o.push(e[n].city),e[n].region&&o.push(e[n].region),e[n].country&&o.push(e[n].country),t+="<div class='newRow visitorRow' data-attr='"+e[n].id+"' data-attr-domain='"+e[n].domain_id+"'><div class='col-xs-10'>",t+="A visitor ",o&&(t+="from "+o.join(", ")),t+=" viewed ";var a=e[n].title||e[n].url;if(a){var i=e[n].url;-1==i.indexOf("http")&&(i="//"+e[n].url),t+="<a href='"+i+"' target='_blank'>"+a.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"")+" </a>"}t+=" - <span id='timeAgo"+e[n].id+"' class='timeAgoContainer' rel='"+e[n].date_created+"'>"+timeSince(e[n].date_created)+"</span>",t+="</div>",t+="<div class='col-xs-2 flagContainer text-right'>",e[n].countryCode?t+="<img src='//www.livewebtraffic.com/images/flags-mini/"+e[n].countryCode.toLowerCase()+".png' style='height:24px;'/>":e[n].country&&(t+="<img src='//www.livewebtraffic.com/images/flags-mini/"+e[n].country.toLowerCase()+".png' style='height:24px;'/>"),t+="</div><div class='clearfix'></div></div>"}return t}function applyNewRow(){setTimeout(function(){for(var e=document.getElementsByClassName("newRow"),t=document.getElementsByClassName("newFeedRow"),n=0;n<e.length;n++)e[n].className="visitorRow";for(n=0;n<t.length;n++)t[n].style.background="none",t[n].style.fontWeight="100",t[n].className=""},3e3)}function convertLocalDateToUTCDate(e,t){var n=6e4*(e=new Date(e)).getTimezoneOffset(),o=e.getTime();return e=t?o+n:o-n,e=new Date(e)}function loadWidget(){var e=document.getElementById("trafficjs"),t=document.createElement("div");t.innerHTML=createTable(location.hostname),e.parentNode.insertBefore(t,e),applyTableStyles();var n="//ip-api.com/json";if(location.protocol.indexOf("https")>-1&&(n="https://ipapi.co/json/"),console.log(navigator),!navigator||navigator&&!navigator.userAgent)return!1;createAjaxRequest("GET",n,ipJsonSuccess,errorCallBack)}loadWidget();